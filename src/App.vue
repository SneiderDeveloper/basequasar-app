<template>
  <div id="q-app">
    <router-view/>
  </div>
</template>

<script>
export default {
  name: 'App',
  beforeDestroy() {
    this.$eventBus.$off('service-worker.update.available')
  },
  watch: {
    'isAppOffline'() {
      this.$filter.reset()
      this.globalAppKey = this.$uid()
    },
  },
  created() {
    this.$nextTick(async function () {
      //Manage badges to button actions
      this.$eventBus.$on('service-worker.update.available', () => {
        this.$alert.info({
          message: this.$tr('isite.cms.message.swUpdateAvailable'),
          pos: 'top',
          icon: 'fas fa-cloud-download-alt',
          timeOut: 15000,
          actions: [
            {
              label: 'Ok',
              icon: '',
              color: 'white',
              handler: () => window.location.reload(true)
            }
          ],
        })
      })
    })
  },
  data() {
    return {
      globalAppKey: this.$uid()
    }
  },
  computed: {
    isAppOffline() {
      return this.$store.state.qofflineMaster.isAppOffline;
    },
  }
}
</script>
